# Gemini

Gemini is a defense system that effectively analyzes large-scale system provenance to reveal multi-step attack sequences. Gemini introduces a novel and expressive domain-specific language, ProvQL, that offers essential primitives for various types of attack analyses (e.g., attack pattern search, attack dependency tracking) with user-defined constraints, enabling security analysts to focus on attack-relevant parts and iteratively sift through the provenance data. Moreover, Gemini provides an optimized execution engine for efficient language execution over the big data. For more information, please refer to our paper.

Built using Java SE 14.

## Sysdig Logs Parser
Given a log generated by Sysdig, parse it, and store the information in a PostgreSql database.

To run:
- Modify database config in `cfg/postgres.properties`
- Modify the parameter `logFile` in `src/main/SysdigMain.java` to the path of your .txt log file
- Run `SysdigMain`
- DB will be auomatically created according to our specified schema, and tables should be then available for querying in the DB

Parameters in SysdigMain:
- logFile: path to .txt log file

## Windows ProcMon Log Parser
Given a log file (.csv) generated by Procmon, parse it, and store the information in a PostgreSql database.

To run:
- Modify database config in `cfg/postgres.properties`
- Modify the parameter `logFile` in `src/main/ProcmonMain.java` to the path of your .csv log file
- Run `ProcmonMain`
- DB will be auomatically created according to our specified schema, and tables should be then available for querying in the DB

Parameters in ProcmonMain:
- logFile: path to .csv log file
- timezone: the timezone of the machine that collects the log
- serverIP: server IP

## Running queries

Edit the query in `input/query.txt` after populating the DB with data from logging.
Run `ExecutorMain` to execute the query. Alternatively, provide a file path as
an argument to `ExecutorMain` instead of using `input/query.txt`.
Multiple queries can be written in the file or `inputStream` to be executed sequentially.

Use `-n` flag to use Neo4j database. Otherwise, the default PostgreSQL database will be used.

Use `-r` flag in arguments to compile to standalone recursive SQL queries (or Cypher queries) instead of using the ProvQL query scheduler.

> You can try the sample query by running `./run_sample`.

## Running queries of evaluation cases

Load logs to corresponding databases (refer to each query `input.txt` in `queries/` for the names of databases) and run `./run_all`. The outputs should appear in output.txt in the same folders.

For downloading system audit logs for all 23 attack cases that we performed on our hosts (excluding 3 darpa tc cases), please refer to [here](https://drive.google.com/file/d/1FD8_1z4aVVRJU6rsPtG80LbXOGr_eHUZ/view?usp=sharing). These log names correspond to the attack cases in the `queries/` folder.